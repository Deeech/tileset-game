function drawImage(image) {
    for (var r = 0; rowTileCount > r; r++) for (var c = 0; colTileCount > c; c++) {
        var tile = ground[r][c];
        tile--;
        var tileRow = tile / imageNumTiles | 0, tileCol = tile % imageNumTiles | 0;
        ctx.drawImage(image, tileCol * tileSize, tileRow * tileSize, tileSize, tileSize, c * tileSize, r * tileSize, tileSize, tileSize);
    }
}

function Game() {
    var player = new Player(4, 4), tick = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height), drawImage(tilesetImage), ctx.fillRect(32 * player.col, 32 * player.row, 32, 32), 
        window.requestAnimationFrame(tick);
    };
    tick();
}

function Player(col, row) {
    this.col = col, this.row = row, this.color = "red";
    var self = this;
    nav[col][row] = 1, window.addEventListener("keydown", function(e) {
        37 == e.keyCode && 0 == nav[self.col - 1][self.row] && (nav[self.col - 1][self.row] = 1, 
        nav[self.col][self.row] = 0, self.col--), 39 == e.keyCode && 0 == nav[self.col + 1][self.row] && (nav[self.col + 1][self.row] = 1, 
        nav[self.col][self.row] = 0, self.col++), 38 == e.keyCode && 0 == nav[self.col][self.row - 1] && (nav[self.col][self.row - 1] = 1, 
        nav[self.col][self.row] = 0, self.row--), 40 == e.keyCode && 0 == nav[self.col][self.row + 1] && (nav[self.col][self.row + 1] = 1, 
        nav[self.col][self.row] = 0, self.row++);
    });
}

var nav = [ [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] ], ground = [ [ 12, 13, 13, 13, 14, 80, 79, 80, 79, 80 ], [ 28, 29, 29, 29, 30, 96, 95, 96, 95, 96 ], [ 28, 29, 29, 29, 30, 80, 79, 80, 79, 80 ], [ 44, 127, 29, 128, 46, 96, 95, 96, 95, 96 ], [ 79, 28, 29, 30, 79, 80, 79, 80, 79, 80 ], [ 95, 28, 29, 30, 95, 96, 95, 96, 95, 96 ], [ 79, 28, 29, 30, 79, 80, 156, 157, 157, 158 ], [ 95, 28, 29, 144, 157, 157, 143, 173, 173, 174 ], [ 79, 28, 173, 173, 173, 173, 173, 173, 173, 174 ], [ 95, 188, 189, 189, 189, 189, 189, 189, 189, 190 ] ], tilesetImage = new Image();

tilesetImage.src = "static/tileset.png";

var canvas = document.getElementById("main"), ctx = canvas.getContext("2d"), tileSize = 32, rowTileCount = 10, colTileCount = 10, imageNumTiles = 16, game = new Game();

window.addEventListener("keydown", function(e) {
    console.clear(), console.table(nav);
});